<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torres de Hanoi - Edición Premium</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css"/>

    <style>
        :root {
            --primary: #8c1eff;
            --secondary: #00fecf;
            --dark: #151934;
            --light: #f9f9f9;
            --danger: #ff2975;
            --success: #5df158;
            --warning: #ffb01f;
            --info: #00b8ff;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, #091022 100%);
            color: var(--light);
            min-height: 100vh;
            padding-bottom: 50px;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect x="0" y="0" width="100" height="100" fill="none"/><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="30" cy="10" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="10" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="10" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="10" cy="30" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="30" cy="30" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="30" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="30" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="30" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="10" cy="50" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="30" cy="50" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="50" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="50" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="10" cy="70" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="30" cy="70" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="70" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="70" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="70" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="10" cy="90" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="30" cy="90" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="90" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="90" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="90" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
            z-index: -1;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .display-4 {
            font-weight: 900;
            text-transform: uppercase;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(140, 30, 255, 0.5);
        }

        .lead {
            font-weight: 300;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.8);
        }

        .container {
            max-width: 1200px;
        }

        .card {
            border: none;
            border-radius: 15px;
            background: rgba(25, 32, 65, 0.7);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }

        .card-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 1.5rem;
        }

        .card-header.bg-primary {
            background: linear-gradient(90deg, var(--primary), #6e00ff) !important;
        }

        .card-header.bg-success {
            background: linear-gradient(90deg, #00c9a7, var(--success)) !important;
        }

        .card-header.bg-dark {
            background: linear-gradient(90deg, #2d3250, #424769) !important;
        }

        .card-header.bg-info {
            background: linear-gradient(90deg, #0072ff, var(--info)) !important;
        }

        .card-header.bg-secondary {
            background: linear-gradient(90deg, #6c757d, #495057) !important;
        }

        .card-body {
            padding: 1.5rem;
        }

        .btn {
            border-radius: 50px;
            padding: 0.6rem 1.5rem;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #6e00ff);
            border: none;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #0056b3);
            border: none;
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #b80042);
            border: none;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #00a84c);
            border: none;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #ff8c00);
            border: none;
            color: white;
        }

        .form-select, .form-control {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 10px;
            padding: 0.7rem 1rem;
        }

        .form-select:focus, .form-control:focus {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: var(--primary);
            box-shadow: 0 0 0 0.25rem rgba(140, 30, 255, 0.25);
            color: white;
        }

        .form-select option {
            background-color: var(--dark);
            color: white;
        }

        .tower-container {
            position: relative;
            height: 250px;
            width: 30%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .tower-container:hover {
            transform: scale(1.05);
        }

        .tower-container.selected {
            box-shadow: 0 0 15px var(--primary);
        }

        .tower {
            position: absolute;
            bottom: 20px;
            width: 12px;
            height: 170px;
            background: linear-gradient(to bottom, #d4af37, #f5d76e, #d4af37);
            border-radius: 6px;
            z-index: 1;
        }

        .tower::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 12px;
            background: #d4af37;
            border-radius: 50%;
        }

        .tower-base {
            width: 100%;
            height: 20px;
            background: linear-gradient(to bottom, #2b2b2b, #4a4a4a);
            border-radius: 10px;
            position: relative;
            z-index: 2;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .disks-container {
            position: absolute;
            bottom: 20px;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            width: 100%;
            z-index: 3;
        }

        .disk {
            height: 20px;
            border-radius: 10px;
            margin-bottom: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.8);
            font-weight: bold;
            font-size: 12px;
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(140, 30, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(140, 30, 255, 0.8); }
            100% { box-shadow: 0 0 5px rgba(140, 30, 255, 0.5); }
        }

        @keyframes pulsate {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .disk-1 { background: linear-gradient(90deg, #ff5757, #ff8c8c); width: 20%; }
        .disk-2 { background: linear-gradient(90deg, #ff914d, #ffbd59); width: 30%; }
        .disk-3 { background: linear-gradient(90deg, #ffde59, #fff7ae); width: 40%; }
        .disk-4 { background: linear-gradient(90deg, #59ff59, #a9ffa9); width: 50%; }
        .disk-5 { background: linear-gradient(90deg, #5981ff, #a9c5ff); width: 60%; }
        .disk-6 { background: linear-gradient(90deg, #a459ff, #d5a9ff); width: 70%; }
        .disk-7 { background: linear-gradient(90deg, #ff59b7, #ffa9e5); width: 80%; }
        .disk-8 { background: linear-gradient(90deg, #8c8c8c, #d1d1d1); width: 90%; }

        .disk.active {
            animation: pulsate 1s infinite;
            box-shadow: 0 0 15px var(--primary);
        }

        #gameStatus {
            font-weight: bold;
        }

        #gameStatus.win {
            font-size: 1.2rem;
            animation: glow 1.5s infinite;
            color: var(--success);
        }

        #timer, #moveCount, #minMoves {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--secondary);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #7a00ff;
        }

        /* Animations */
        .floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }

        /* Stat Icons */
        .stat-icon {
            font-size: 1.5rem;
            margin-right: 10px;
            color: var(--secondary);
            display: inline-block;
            width: 30px;
            text-align: center;
            vertical-align: middle;
        }

        /* Instructions List */
        .instr-list {
            list-style: none;
            padding-left: 0;
        }

        .instr-list li {
            position: relative;
            padding-left: 30px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }

        .instr-list li:before {
            content: "\f00c";
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            left: 0;
            top: 0;
            color: var(--success);
            background: rgba(93, 241, 88, 0.1);
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* Game Area Spotlight */
        #gameArea {
            position: relative;
            padding: 50px 0;
            background: radial-gradient(circle at center, rgba(25, 32, 65, 0.4) 0%, rgba(21, 25, 52, 0.95) 80%);
            border-radius: 15px;
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            margin-top: 10px;
            overflow: hidden;
            height: 8px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            border-radius: 30px;
            transition: width 0.5s ease;
            width: 0%;
        }

        /* Solution progress */
        .solution-progress {
            margin-top: 20px;
        }

        /* Modal styling */
        .modal-content {
            background: rgba(25, 32, 65, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(140, 30, 255, 0.2);
            border-radius: 15px;
            color: white;
        }

        .modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Confetti effect for win */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            opacity: 0;
        }

        /* Tower Label */
        .tower-label {
            position: absolute;
            bottom: -5px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--secondary);
            font-size: 0.9rem;
            text-shadow: 0 0 5px rgba(0, 254, 207, 0.5);
        }

        /* Solution Control Buttons */
        .solution-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .solution-controls .btn {
            padding: 0.4rem 1rem;
            font-size: 0.9rem;
        }

        /* Active step highlight */
        .list-group-item.active-step {
            background-color: rgba(140, 30, 255, 0.2);
            border-left: 4px solid var(--primary);
            animation: glow 1.5s infinite;
        }

        /* Solution speed control */
        .speed-control {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            gap: 10px;
        }

        .speed-slider {
            width: 150px;
            background: rgba(255, 255, 255, 0.2);
            height: 6px;
            border-radius: 3px;
            -webkit-appearance: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--secondary);
            cursor: pointer;
        }

        /* Media queries */
        @media (max-width: 768px) {
            .tower-container {
                height: 200px;
            }

            .tower {
                height: 140px;
            }

            .display-4 {
                font-size: 2.5rem;
            }

            .disk {
                height: 15px;
                font-size: 10px;
            }
        }

        @media (max-width: 576px) {
            .tower-container {
                height: 180px;
            }

            .tower {
                height: 120px;
            }

            .display-4 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <header class="text-center mb-5">
            <h1 class="display-4 animate__animated animate__fadeInDown mb-2">Torres de Hanoi</h1>
            <p class="lead animate__animated animate__fadeIn animate__delay-1s">El legendario rompecabezas en una experiencia inmersiva</p>
        </header>

        <div class="row mb-4">
            <div class="col-md-6 animate__animated animate__fadeInLeft animate__delay-1s">
                <div class="card" data-aos="fade-right">
                    <div class="card-header bg-primary">
                        <h2 class="h5 mb-0"><i class="fas fa-gamepad me-2"></i>Controles</h2>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="diskCount" class="form-label"><i class="fas fa-layer-group me-2"></i>Número de discos:</label>
                            <select id="diskCount" class="form-select">
                                <option value="3">3 - Principiante</option>
                                <option value="4">4 - Fácil</option>
                                <option value="5">5 - Intermedio</option>
                                <option value="6">6 - Avanzado</option>
                                <option value="7">7 - Experto</option>
                                <option value="8">8 - Maestro</option>
                            </select>
                        </div>
                        <div class="d-grid gap-2">
                            <button id="newGameBtn" class="btn btn-primary"><i class="fas fa-play me-2"></i>Nuevo Juego</button>
                            <button id="solutionBtn" class="btn btn-info"><i class="fas fa-magic me-2"></i>Mostrar Solución</button>
                            <button id="resetBtn" class="btn btn-danger"><i class="fas fa-redo-alt me-2"></i>Reiniciar</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 animate__animated animate__fadeInRight animate__delay-1s">
                <div class="card" data-aos="fade-left">
                    <div class="card-header bg-success">
                        <h2 class="h5 mb-0"><i class="fas fa-chart-line me-2"></i>Estadísticas</h2>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <p><i class="fas fa-shoe-prints stat-icon"></i><strong>Movimientos:</strong> <span id="moveCount">0</span></p>
                                <p><i class="fas fa-bullseye stat-icon"></i><strong>Mínimo:</strong> <span id="minMoves">7</span></p>
                                <div class="progress-container">
                                    <div class="progress-bar" id="moveProgress"></div>
                                </div>
                            </div>
                            <div class="col-6">
                                <p><i class="fas fa-stopwatch stat-icon"></i><strong>Tiempo:</strong> <span id="timer">00:00</span></p>
                                <p id="gameStatus" class="text-success"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <div class="card floating" data-aos="zoom-in">
                    <div class="card-header bg-dark">
                        <h2 class="h5 mb-0"><i class="fas fa-chess-board me-2"></i>Área de Juego</h2>
                    </div>
                    <div class="card-body p-0">
                        <div id="gameArea" class="d-flex justify-content-around py-4">
                            <div class="tower-container" id="tower0">
                                <div class="tower"></div>
                                <div class="tower-base"></div>
                                <div class="disks-container"></div>
                                <div class="tower-label">Torre A</div>
                            </div>
                            <div class="tower-container" id="tower1">
                                <div class="tower"></div>
                                <div class="tower-base"></div>
                                <div class="disks-container"></div>
                                <div class="tower-label">Torre B</div>
                            </div>
                            <div class="tower-container" id="tower2">
                                <div class="tower"></div>
                                <div class="tower-base"></div>
                                <div class="disks-container"></div>
                                <div class="tower-label">Torre C</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card" data-aos="fade-up">
                    <div class="card-header bg-secondary">
                        <h2 class="h5 mb-0"><i class="fas fa-info-circle me-2"></i>Instrucciones</h2>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h3 class="h6"><i class="fas fa-book me-2"></i>Reglas:</h3>
                                <ul class="instr-list">
                                    <li>Solo se puede mover un disco a la vez.</li>
                                    <li>Cada movimiento consiste en tomar el disco superior de una pila y colocarlo en la parte superior de otra pila.</li>
                                    <li>Ningún disco puede colocarse encima de un disco más pequeño.</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h3 class="h6"><i class="fas fa-hand-pointer me-2"></i>Cómo jugar:</h3>
                                <p>Haz clic en la torre de origen y luego en la torre de destino para mover un disco. Intenta completar el puzzle con el mínimo número de movimientos posibles.</p>
                                <div class="alert alert-info p-2 mt-2" style="background-color: rgba(0, 184, 255, 0.1); border: 1px solid rgba(0, 184, 255, 0.3); border-radius: 10px;">
                                    <i class="fas fa-lightbulb me-2"></i> <strong>Tip:</strong> El número mínimo de movimientos para resolver el puzzle es 2<sup>n</sup> - 1, donde n es el número de discos.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="winModal" tabindex="-1" aria-labelledby="winModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="winModalLabel"><i class="fas fa-trophy text-warning me-2"></i>¡Felicitaciones!</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <i class="fas fa-star text-warning" style="font-size: 3rem;"></i>
                    </div>
                    <h4>¡Has completado el desafío!</h4>
                    <p>Has resuelto las Torres de Hanoi con <span id="finalMoves">0</span> movimientos en <span id="finalTime">00:00</span>.</p>
                    <p>El mínimo posible era: <span id="finalMinMoves">0</span> movimientos.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-success" id="newGameModalBtn">Nuevo Juego</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="solutionModal" tabindex="-1" aria-labelledby="solutionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="solutionModalLabel"><i class="fas fa-lightbulb text-info me-2"></i>Solución del Juego</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Observa la solución paso a paso. Puedes controlar la reproducción:</p>
                    <div class="solution-controls">
                        <button id="playSolutionBtn" class="btn btn-success"><i class="fas fa-play me-2"></i>Reproducir</button>
                        <button id="pauseSolutionBtn" class="btn btn-warning"><i class="fas fa-pause me-2"></i>Pausa</button>
                        <button id="prevStepBtn" class="btn btn-secondary"><i class="fas fa-backward me-2"></i>Anterior</button>
                        <button id="nextStepBtn" class="btn btn-secondary"><i class="fas fa-forward me-2"></i>Siguiente</button>
                        <button id="stopSolutionBtn" class="btn btn-danger"><i class="fas fa-stop me-2"></i>Detener</button>
                    </div>
                    <div class="speed-control">
                        <span>Velocidad:</span>
                        <input type="range" id="solutionSpeedSlider" min="100" max="2000" value="500">
                        <span id="solutionSpeedValue">0.5s</span>
                    </div>
                    <hr>
                    <ol id="solutionSteps" class="list-group list-group-flush">
                        </ol>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>

    <script>
        AOS.init({
            duration: 1000,
            once: true,
        });

        // Game Variables
        let numberOfDisks = 3;
        let towers = [[], [], []]; // Representing the three towers
        let selectedDisk = null; // Stores the disk currently being moved
        let selectedTower = null; // Stores the tower from which a disk is picked
        let moveCount = 0;
        let timerInterval;
        let seconds = 0;
        let isGameActive = false;
        let solutionSteps = [];
        let solutionIndex = 0;
        let solutionPlaybackInterval;
        let solutionSpeed = 500; // milliseconds

        // DOM Elements
        const diskCountSelect = document.getElementById('diskCount');
        const newGameBtn = document.getElementById('newGameBtn');
        const solutionBtn = document.getElementById('solutionBtn');
        const resetBtn = document.getElementById('resetBtn');
        const moveCountSpan = document.getElementById('moveCount');
        const minMovesSpan = document.getElementById('minMoves');
        const timerSpan = document.getElementById('timer');
        const gameStatusSpan = document.getElementById('gameStatus');
        const gameArea = document.getElementById('gameArea');
        const towerContainers = [
            document.getElementById('tower0'),
            document.getElementById('tower1'),
            document.getElementById('tower2')
        ];
        const winModal = new bootstrap.Modal(document.getElementById('winModal'));
        const solutionModal = new bootstrap.Modal(document.getElementById('solutionModal'));
        const finalMovesSpan = document.getElementById('finalMoves');
        const finalTimeSpan = document.getElementById('finalTime');
        const finalMinMovesSpan = document.getElementById('finalMinMoves');
        const newGameModalBtn = document.getElementById('newGameModalBtn');
        const solutionStepsList = document.getElementById('solutionSteps');
        const moveProgressBar = document.getElementById('moveProgress');

        // Solution Controls
        const playSolutionBtn = document.getElementById('playSolutionBtn');
        const pauseSolutionBtn = document.getElementById('pauseSolutionBtn');
        const prevStepBtn = document.getElementById('prevStepBtn');
        const nextStepBtn = document.getElementById('nextStepBtn');
        const stopSolutionBtn = document.getElementById('stopSolutionBtn');
        const solutionSpeedSlider = document.getElementById('solutionSpeedSlider');
        const solutionSpeedValueSpan = document.getElementById('solutionSpeedValue');

        // Event Listeners
        newGameBtn.addEventListener('click', startNewGame);
        diskCountSelect.addEventListener('change', () => {
            numberOfDisks = parseInt(diskCountSelect.value);
            minMovesSpan.textContent = (Math.pow(2, numberOfDisks) - 1).toString();
            startNewGame();
        });
        solutionBtn.addEventListener('click', showSolution);
        resetBtn.addEventListener('click', resetGame);
        newGameModalBtn.addEventListener('click', () => {
            winModal.hide();
            startNewGame();
        });

        towerContainers.forEach((tower, index) => {
            tower.addEventListener('click', () => handleTowerClick(index));
        });

        // Solution playback listeners
        playSolutionBtn.addEventListener('click', playSolution);
        pauseSolutionBtn.addEventListener('click', pauseSolution);
        prevStepBtn.addEventListener('click', () => goToSolutionStep(solutionIndex - 1));
        nextStepBtn.addEventListener('click', () => goToSolutionStep(solutionIndex + 1));
        stopSolutionBtn.addEventListener('click', stopSolution);
        solutionSpeedSlider.addEventListener('input', (e) => {
            solutionSpeed = 2100 - parseInt(e.target.value); // Invert slider for intuitive speed control
            solutionSpeedValueSpan.textContent = `${(solutionSpeed / 1000).toFixed(1)}s`;
            if (solutionPlaybackInterval) { // If playing, restart with new speed
                pauseSolution();
                playSolution();
            }
        });

        // Game Logic Functions

        function startNewGame() {
            resetGame();
            isGameActive = true;
            towers = [[], [], []];
            solutionSteps = [];
            solutionIndex = 0;

            // Populate the first tower with disks
            for (let i = numberOfDisks; i >= 1; i--) {
                towers[0].push(i);
            }

            renderDisks();
            updateStats();
            startTimer();
            gameStatusSpan.textContent = '';
            gameStatusSpan.classList.remove('win');
            calculateHanoiSolution(numberOfDisks, 0, 2, 1); // Calculate solution for the new game
        }

        function resetGame() {
            stopTimer();
            pauseSolution(); // Stop solution playback if active
            moveCount = 0;
            selectedDisk = null;
            selectedTower = null;
            isGameActive = false;
            towers = [[], [], []]; // Clear all towers
            renderDisks(); // Clear the display
            updateStats();
            timerSpan.textContent = '00:00';
            gameStatusSpan.textContent = '';
            gameStatusSpan.classList.remove('win');
            minMovesSpan.textContent = (Math.pow(2, numberOfDisks) - 1).toString();
            solutionSteps = [];
            solutionIndex = 0;
            // Re-populate the first tower for user play, if not in solution mode
            for (let i = numberOfDisks; i >= 1; i--) {
                towers[0].push(i);
            }
            renderDisks();
        }

        function renderDisks() {
            towerContainers.forEach((towerContainer, towerIndex) => {
                const disksContainer = towerContainer.querySelector('.disks-container');
                disksContainer.innerHTML = ''; // Clear existing disks

                towers[towerIndex].forEach(diskSize => {
                    const disk = document.createElement('div');
                    disk.classList.add('disk', `disk-${diskSize}`);
                    disk.dataset.size = diskSize;
                    disk.textContent = diskSize; // Optional: display disk size
                    disksContainer.appendChild(disk);
                });
            });
        }

        function handleTowerClick(towerIndex) {
            if (!isGameActive) return;

            const targetTower = towers[towerIndex];

            if (selectedDisk === null) {
                // No disk selected yet, try to pick one
                if (targetTower.length > 0) {
                    selectedDisk = targetTower[targetTower.length - 1]; // Get the top disk
                    selectedTower = towerIndex;
                    towerContainers[selectedTower].classList.add('selected');
                }
            } else {
                // A disk is already selected, try to place it
                if (towerIndex === selectedTower) {
                    // Clicking the same tower deselects the disk
                    selectedDisk = null;
                    selectedTower = null;
                    towerContainers.forEach(t => t.classList.remove('selected'));
                } else if (targetTower.length === 0 || selectedDisk < targetTower[targetTower.length - 1]) {
                    // Valid move: target tower is empty or top disk is larger
                    moveDisk(selectedTower, towerIndex);
                    selectedDisk = null;
                    selectedTower = null;
                    towerContainers.forEach(t => t.classList.remove('selected'));
                } else {
                    // Invalid move
                    alert('¡Movimiento inválido! No puedes colocar un disco grande sobre uno más pequeño.');
                    selectedDisk = null; // Deselect to allow a new attempt
                    selectedTower = null;
                    towerContainers.forEach(t => t.classList.remove('selected'));
                }
            }
        }

        function moveDisk(sourceTowerIndex, destTowerIndex, isSolutionMove = false) {
            if (towers[sourceTowerIndex].length === 0) return; // Should not happen with validation

            const diskToMove = towers[sourceTowerIndex].pop();
            towers[destTowerIndex].push(diskToMove);

            if (!isSolutionMove) { // Only increment moveCount for user-driven moves
                moveCount++;
                updateStats();
            }

            renderDisks();

            if (!isSolutionMove && checkWinCondition()) {
                winGame();
            }
        }

        function updateStats() {
            moveCountSpan.textContent = moveCount;
            const minMoves = Math.pow(2, numberOfDisks) - 1;
            minMovesSpan.textContent = minMoves;

            const progress = Math.min(100, (moveCount / minMoves) * 100);
            moveProgressBar.style.width = `${progress}%`;
            moveProgressBar.classList.add('animate__animated', 'animate__fadeIn');
            setTimeout(() => {
                moveProgressBar.classList.remove('animate__animated', 'animate__fadeIn');
            }, 500);
        }

        function startTimer() {
            seconds = 0;
            stopTimer(); // Clear any existing timer
            timerInterval = setInterval(() => {
                seconds++;
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                timerSpan.textContent = `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function checkWinCondition() {
            // Win condition: all disks are on the last tower (tower 2)
            return towers[2].length === numberOfDisks;
        }

        function winGame() {
            isGameActive = false;
            stopTimer();
            gameStatusSpan.textContent = '¡GANASTE!';
            gameStatusSpan.classList.add('win');

            finalMovesSpan.textContent = moveCount;
            finalTimeSpan.textContent = timerSpan.textContent;
            finalMinMovesSpan.textContent = Math.pow(2, numberOfDisks) - 1;

            winModal.show();
            triggerConfetti();
        }

        function triggerConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.style.position = 'fixed';
            confettiContainer.style.top = '0';
            confettiContainer.style.left = '0';
            confettiContainer.style.width = '100%';
            confettiContainer.style.height = '100%';
            confettiContainer.style.pointerEvents = 'none';
            confettiContainer.style.zIndex = '9999';
            document.body.appendChild(confettiContainer);

            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.top = `${Math.random() * 100}vh`;
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 60%)`;
                confetti.style.opacity = '1';
                confetti.style.transform = `scale(${Math.random() * 1 + 0.5})`;
                confetti.style.transition = `transform ${Math.random() * 0.5 + 0.5}s ease-out, top ${Math.random() * 3 + 2}s ease-in, opacity ${Math.random() * 0.5 + 0.5}s linear`;

                confettiContainer.appendChild(confetti);

                setTimeout(() => {
                    confetti.style.top = '110vh';
                    confetti.style.opacity = '0';
                }, 10);
            }

            setTimeout(() => {
                confettiContainer.remove();
            }, 5000);
        }

        // Solution Logic (Recursive Hanoi)
        function calculateHanoiSolution(n, source, destination, auxiliary) {
            if (n === 1) {
                solutionSteps.push({ disk: 1, from: source, to: destination });
                return;
            }
            calculateHanoiSolution(n - 1, source, auxiliary, destination);
            solutionSteps.push({ disk: n, from: source, to: destination });
            calculateHanoiSolution(n - 1, auxiliary, destination, source);
        }

        function showSolution() {
            if (solutionSteps.length === 0) {
                // If solution not calculated for current disk count, calculate it.
                // This might happen if the user clicks "Show Solution" immediately after changing disk count.
                calculateHanoiSolution(numberOfDisks, 0, 2, 1);
            }

            // Reset game state to initial for solution playback
            towers = [[], [], []];
            for (let i = numberOfDisks; i >= 1; i--) {
                towers[0].push(i);
            }
            renderDisks(); // Initial state for solution

            isGameActive = false; // Disable user interaction during solution playback
            stopTimer(); // Stop the user game timer

            solutionIndex = 0;
            populateSolutionStepsList();
            highlightCurrentSolutionStep();
            solutionModal.show();
        }

        function populateSolutionStepsList() {
            solutionStepsList.innerHTML = '';
            solutionSteps.forEach((step, index) => {
                const listItem = document.createElement('li');
                listItem.classList.add('list-group-item', 'd-flex', 'align-items-center', 'py-2');
                listItem.innerHTML = `<span class="badge bg-primary rounded-pill me-3">${index + 1}</span> Mover Disco ${step.disk} de Torre ${String.fromCharCode(65 + step.from)} a Torre ${String.fromCharCode(65 + step.to)}`;
                solutionStepsList.appendChild(listItem);
            });
        }

        function highlightCurrentSolutionStep() {
            const allSteps = solutionStepsList.querySelectorAll('li');
            allSteps.forEach((step, index) => {
                if (index === solutionIndex) {
                    step.classList.add('active-step');
                    step.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    step.classList.remove('active-step');
                }
            });
        }

        function playSolution() {
            if (solutionPlaybackInterval) return; // Already playing

            solutionPlaybackInterval = setInterval(() => {
                if (solutionIndex < solutionSteps.length) {
                    executeSolutionStep(solutionIndex);
                    solutionIndex++;
                    highlightCurrentSolutionStep();
                } else {
                    pauseSolution(); // End of solution
                    gameStatusSpan.textContent = '¡Solución Completa!';
                    gameStatusSpan.classList.add('win');
                }
            }, solutionSpeed);
        }

        function pauseSolution() {
            clearInterval(solutionPlaybackInterval);
            solutionPlaybackInterval = null;
        }

        function stopSolution() {
            pauseSolution();
            // Reset to initial state for solution display
            towers = [[], [], []];
            for (let i = numberOfDisks; i >= 1; i--) {
                towers[0].push(i);
            }
            renderDisks();
            solutionIndex = 0;
            highlightCurrentSolutionStep();
            gameStatusSpan.textContent = '';
            gameStatusSpan.classList.remove('win');
        }

        function goToSolutionStep(index) {
            if (index >= 0 && index <= solutionSteps.length) {
                pauseSolution(); // Pause if playing
                solutionIndex = index;

                // Re-initialize towers to display the state up to this step
                towers = [[], [], []];
                for (let i = numberOfDisks; i >= 1; i--) {
                    towers[0].push(i);
                }
                renderDisks(); // Reset to initial state

                // Apply all steps up to the current index
                for (let i = 0; i < solutionIndex; i++) {
                    const step = solutionSteps[i];
                    // Temporarily remove disk to move it from source and add to destination
                    const diskToMove = towers[step.from].pop();
                    towers[step.to].push(diskToMove);
                }
                renderDisks(); // Update the visual state

                highlightCurrentSolutionStep();
            }
        }

        function executeSolutionStep(index) {
            const step = solutionSteps[index];
            if (step) {
                moveDisk(step.from, step.to, true); // true indicates a solution move
            }
        }

        // Initialize game on load
        startNewGame();
        solutionSpeedValueSpan.textContent = `${(solutionSpeed / 1000).toFixed(1)}s`; // Initial speed display
    </script>
</body>
</html>